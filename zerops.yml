zerops:
  - setup: scraper
    build:
      base: ubuntu@22.04
      prepareCommands:
        - sudo apt-get update -y
        - sudo apt-get install git -y
      buildCommands:
        - rm -rf *
        - rm -rf .git
        - ls -la
        - git clone https://github.com/meilisearch/docs-scraper .
        - ls -la
      addToRunPrepare:
        - Pipfile
        - Pipfile.lock
      deployFiles: ./
    run:
      base: python@3.11
      envVariables:
        MEILISEARCH_API_KEY: c8f5b89c64aacb12345ced6c90920286ca5efcfb0c21f61afa6dbd70b5e71363
        MEILISEARCH_HOST_URL: http://meilisearch:7700
      prepareCommands:
        - pip install --user pipenv
        - ln -s /root/.local/bin/pipenv /usr/local/bin/pipenv
        - ln -s /root/.local/bin/pipenv-resolver /usr/local/bin/pipenv-resolver
        - zsc scale ram max 10m
        - sleep 30
        - pipenv install --system
      initCommands:
        - echo $MEILISEARCH_SCAPER_CONFIG
        - echo "$MEILISEARCH_SCAPER_CONFIG" > config.json
      start: python ./docs_scraper ./config.json
